<!-- Load Blockly core -->
<script src="https://unpkg.com/blockly/blockly.min.js"></script>
<!-- Load a message file -->
<script src="https://unpkg.com/blockly/msg/en.js"></script>

<style>
  body {
    padding: 0;
    margin: 0;
  }

  /* 1. Remove yellow block selection outline */
  .blocklyPathSelected {
    stroke: none !important;
    stroke-width: 0 !important;
  }

  /* 2. Keep normal fill for selected block */
  .blocklySelected .blocklyPath {
    fill-opacity: 1 !important;
  }

  /* 3. Dark drop shadow on dragging blocks */
  .blocklyDragging {
    filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.4));
  }

  /* 4. Subtle opacity on dragged block paths */
  .blocklyDragging .blocklyPath {
    opacity: 0.95;
  }

  /* Make the connection highlight white and thick */
  .blocklyConnectionHighlightPath {
    stroke: #ffffff !important;
    stroke-width: 4px !important;
  }

  /* Override the insertion marker path */
  .blocklyInsertionMarker > .blocklyPath {
    stroke: #ffffff !important;
    stroke-width: 4px !important;
    fill: none !important;
  }
</style>

<div id="blocklyDiv" style="height: 100%; width: 100%;"></div>

<script src="script.js"></script>

<script>
// 1. Force Zelos constants: white + thick highlight stroke
class WhiteHighlight extends Blockly.zelos.HighlightConstantProvider {
  constructor() {
    super();
    this.HIGHLIGHT_COLOR = '#ffffff';
    this.HIGHLIGHT_SIZE = 4;  // Thickness
  }
}
Blockly.zelos.Renderer.prototype.makeHighlightConstants_ = function() {
  return new WhiteHighlight();
};


// 2. Override connection highlight drawing
const originalHighlight = Blockly.zelos.Renderer.prototype.highlightConnection_;

Blockly.zelos.Renderer.prototype.highlightConnection_ = function(conn, add) {
  originalHighlight.call(this, conn, add);

  if (conn.highlightedPath) {
    conn.highlightedPath.setAttribute("stroke", "#ffffff");
    conn.highlightedPath.setAttribute("stroke-width", "4");
    conn.highlightedPath.setAttribute("opacity", "1");
    conn.highlightedPath.setAttribute("fill", "none");
  }
};


// 3. Override insertion marker creation (the thin white line problem)
Blockly.zelos.Renderer.prototype.makeInsertionMarker_ = function(block) {
  const marker = Blockly.zelos.Renderer.superClass_.makeInsertionMarker_.call(this, block);

  const path = marker.getSvgRoot().querySelector(".blocklyPath");
  if (path) {
    path.setAttribute("stroke", "#ffffff");
    path.setAttribute("stroke-width", "4");
    path.setAttribute("fill", "none");
    path.setAttribute("opacity", "1");
  }

  return marker;
};


// 4. Prevent Blockly from restoring yellow outline on shadow inputs
Blockly.zelos.Renderer.prototype.updateConnectionHighlight_ = function(conn) {
  if (conn.highlightedPath) {
    conn.highlightedPath.setAttribute("stroke", "#ffffff");
    conn.highlightedPath.setAttribute("stroke-width", "4");
    conn.highlightedPath.setAttribute("opacity", "1");
    conn.highlightedPath.setAttribute("fill", "none");
  }
};
</script>
