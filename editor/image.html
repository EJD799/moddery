<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Editor Example</title>
<style>
  body { margin: 0; background: #333; overflow: hidden; }
  #editor-container { width: 100vw; height: 100vh; }
</style>
<script src="https://cdn.jsdelivr.net/gh/NaiveAI/mini-canvas-editor@latest/dist/mini-canvas-editor.umd.js"></script>
</head>
<body>
  <div id="editor-container"></div>
<script>
(async () => {
  // Create editor
  const container = document.getElementById("editor-container");
  const editorInstance = await miniCanvasEditor.Editor.createBlank(container, 1200, 800, {});
  console.log("Created editorInstance:", editorInstance);

  // Find the internal Fabric canvas
  let fabricCanvas = null;
  if (editorInstance?.workspace?.canvas) {
    fabricCanvas = editorInstance.workspace.canvas;
    console.log("Found fabricCanvas:", fabricCanvas);
  } else {
    console.error("Fabric canvas not found in editorInstance");
  }

  // Handle keyboard shortcuts safely
  document.addEventListener("keydown", (e) => {
    if (!fabricCanvas) return;

    // DELETE or BACKSPACE: delete selected non-focused object
    if (e.key === "Backspace" || e.key === "Delete") {
      const active = fabricCanvas.getActiveObject?.();
      const focusedTextbox = document.activeElement?.tagName === "TEXTAREA" || document.activeElement?.tagName === "INPUT";
      if (active && !focusedTextbox) {
        fabricCanvas.remove(active);
        fabricCanvas.requestRenderAll();
        e.preventDefault();
      }
    }

    // Undo / Redo
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "z") {
      e.preventDefault();
      editorInstance.history?.undo?.();
    }
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "y") {
      e.preventDefault();
      editorInstance.history?.redo?.();
    }
  });

  // Example: add one rectangle
  fabricCanvas.add(new miniCanvasEditor.fabric.Rect({
    left: 200, top: 150, width: 200, height: 120, fill: 'red'
  }));

})();
</script>
</body>
</html>
