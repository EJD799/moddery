<!DOCTYPE html>
<html data-theme="dark">
  <head>
    <link rel="icon" type="image/x-icon" href="moddery_icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="jquery-ui.min.css">
    <link rel="stylesheet" href="jquery-ui.theme.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="jquery-3.7.1.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
    <script src="jszip.min.js"></script>
    <script src="FileSaver.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://ejd799.github.io/BulmaColoredInputs/main.css">

    <title>Moddery</title>

    <style>
      html, body {
        height: 100%;
        margin: 0;
        overflow: hidden;
      }

      /* =========================
        GLOBAL LAYOUT FIX
        ========================= */

      /* Ensure header stacks above content */
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
    </style>
  </head>

  <body>

		<header class="menubar">
			<div class="menubar-left">
				<div class="navbar-item has-dropdown is-hoverable">
					<a class="navbar-link is-arrowless">
						<img src="moddery_logo.svg">
					</a>
					<div class="navbar-dropdown">
						<a class="navbar-item" onclick="openOptionsDlg();">
							<i class="fas fa-sliders"></i> Options
						</a>
						<a class="navbar-item" onclick="openOptionsDlg();switchOptionsTab(4);">
							<i class="fas fa-circle-info"></i> About Moddery
						</a>
						<a class="navbar-item" onclick="window.open('https://github.com/ejd799/moddery');">
							<i class="fa-brands fa-github"></i> View Source
						</a>
					</div>
				</div>
				<div class="navbar-item has-dropdown is-hoverable">
					<a class="navbar-link is-arrowless">
						File
					</a>
					<div class="navbar-dropdown">
						<a class="navbar-item" onclick="openNewProjDlg();">
							<i class="fas fa-file"></i> New
						</a>
						<a class="navbar-item" onclick="openProjDlg();">
							<i class="fas fa-folder-open"></i> Open...
						</a>
						<a class="navbar-item" onclick="saveProject();">
							<i class="fas fa-floppy-disk"></i> Save
						</a>
						<a class="navbar-item" onclick="saveProjectAs();">
							<i class="fas fa-floppy-disk"></i> Save As...
						</a>
						<a class="navbar-item" onclick="openExportDlg();">
							<i class="fas fa-download"></i> Export
						</a>
					</div>
				</div>
			</div>

			<div class="menubar-right">
        <a class="navbar-item" id="savingBox">
          <span id="savingText">Loading...</span>
        </a>
			</div>
		</header>

    <div id="savingFlyout" class="card">
      <p id="savingFlyoutText">Last saved never</p>
      <br>
      <button id="savingFlyoutButton" onclick="saveProject()" class="button is-primary">Save Now</button>
    </div>

    <div id="tabs">
      <ul id="tabBar">
        <li><button class="button is-light" onclick="openEditProjDlg()" id="editProjBtn"><i class="fas fa-newspaper"></i></button></li>
        <li><button class="button is-light" onclick="openAddElementDlg()" id="addElementBtn">+ <i class="fas fa-cubes"></i></button></li>
        <li><button class="button is-light" onclick="openAddAssetDlg()" id="addAssetBtn">+ <i class="fas fa-image"></i></button></li>
        <li><a href="#tabs-1"><i class="fas fa-cubes"></i> Elements</a></li>
        <li><a href="#tabs-2"><i class="fas fa-image"></i> Assets</a></li>
      </ul>
      <div id="tabs-1">
        <p>Press the "+ <i class="fas fa-cubes"></i>" button to add an element.</p>
      </div>
      <div id="tabs-2">
        <p>Press the "+ <i class="fas fa-image"></i>" button to add an asset.</p>
      </div>
    </div>

    <div id="welcome">
      <center>
        <h1 class="title is-1">Moddery</h1>
        <p>An open-source, web-based mod builder for Minecraft</p><br><br>
        <button onclick="openNewProjDlg()" class="button is-primary"><i class="fas fa-file"></i> New Project</button>
        <button onclick="openProjDlg()" class="button"><i class="fas fa-folder-open"></i> Open Project</button>
        <br><br>
        <div id="welcomeInfoBox" class="card">
          
        </div>
      </center>
    </div>

    <div class="modal" id="newProjDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:400px;height:500px;">
        <div class="card" id="newProjDlgCard" style="padding:16px;">
          <center>
            <h4 class="title is-4">New Project</h4>
            <label for="newProjNameBox">Project Name</label>
            <input class="input" type="text" id="newProjNameBox" placeholder="Project Name">
            <br><br>
            <label for="newProjType">Project Type</label>
            <div class="select">
              <select id="newProjType">
                <optgroup label="Bedrock Edition">
                  <option value="be_addon" selected>Addon</option>
                  <option value="be_rp" disabled>Resource Pack</option>
                </optgroup>
                <optgroup label="Java Edition">
                  <option value="je_dp" disabled>Datapack</option>
                  <option value="je_rp" disabled>Resource Pack</option>
                  <option value="je_forge" disabled>Forge Mod</option>
                  <option value="je_fabric" disabled>Fabric Mod</option>
                  <option value="je_spigot" disabled>Spigot Plugin</option>
                </optgroup>
                <optgroup label="Other">
                  <option value="mtr_je" disabled>MTR Content (Java)</option>
                  <option value="mtr_be" disabled>MTR Content (Bedrock)</option>
                  <option value="nexo" disabled>Nexo Addon (Java)</option>
                </optgroup>
              </select>
            </div>
            <br><br>
            <label for="newProjNamespaceBox">Namespace ID</label>
            <input class="input" type="text" name="newProjNamespaceBox" id="newProjNamespaceBox" placeholder="Namespace ID">
            <br><br>
            <button class="button" id="newProjCancelBtn" onclick="closeNewProjDlg()">Cancel</button>
            <button class="button is-primary" id="newProjCreateBtn" onclick="createProject()">Create</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeNewProjDlg();"></button>
    </div>

    <div class="modal" id="editProjDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:400px;height:600px;">
        <div class="card" id="editProjDlgCard" style="padding:16px;">
          <center>
            <h4 class="title is-4">Edit Project</h4>
            <label for="editProjNameBox">Project Name</label>
            <input class="input" type="text" name="editProjNameBox" id="editProjNameBox" placeholder="Project Name">
            <br><br>
            <label for="editProjNamespaceBox">Namespace ID</label>
            <input class="input" type="text" name="editProjNamespaceBox" id="editProjNamespaceBox" placeholder="Namespace ID">
            <br><br>
            <label for="editProjVersionBox1">Addon Version</label>
            <input class="input versionBox" type="number" name="editProjVersionBox1" id="editProjVersionBox1" placeholder="1" value="1">.
            <input class="input versionBox" type="number" name="editProjVersionBox2" id="editProjVersionBox2" placeholder="0" value="0">.
            <input class="input versionBox" type="number" name="editProjVersionBox3" id="editProjVersionBox3" placeholder="0" value="0">
            <br><br>
            <label for="editProjMCVersionBox">Target Minecraft Version</label>
            <div class="select">
              <select id="editProjMCVersionBox">
                <option>1.21.90</option>
              </select>
            </div>
            <br><br>
            <label for="packIconBtn">Pack Icon: <span id="packIconText">No icon selected</span></label>
            <button class="button" name="packIconBtn" id="packIconBtn" onclick="openSelectPackIconDlg()">Select Icon</button>
            <br><br>
            <label for="scriptEntryBtn">Pack Icon: <span id="scriptEntryText">No script entry point selected</span></label>
            <button class="button" name="scriptEntryBtn" id="scriptEntryBtn" onclick="openSelectScriptEntryDlg()">Select Script Entry Point</button>
            <br><br>
            <label for="editProjDescriptionBox">Description</label>
            <textarea class="textarea" name="editProjDescriptionBox" id="editProjDescriptionBox"></textarea>
            <br><br>
            <button class="button" id="editProjCancelBtn" onclick="closeEditProjDlg()">Cancel</button>
            <button class="button is-primary" id="editProjSaveBtn" onclick="saveProjectInfo()">Save</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeEditProjDlg();"></button>
    </div>

    <div class="modal" id="selectPackIconDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:400px;height:550px;">
        <div class="card" id="selectPackIconDlgCard" style="padding:16px;">
          <center>
            <h4 class="title is-4">Edit Project</h4>
            <div class="textureMenu" id="selectPackIconMenu"></div>
            <div class="textureDialogButtons">
                <button class="button" id="selectPackIconCancelBtn" onclick="closeSelectPackIconDlg()">Cancel</button>
                <button class="button is-primary" id="selectPackIconSelectBtn" onclick="selectPackIcon()">Select</button>
            </div>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeSelectPackIconDlg();"></button>
    </div>

    <div id="selectScriptEntryDlg" title="Select Script Entry Point">
        <div class="textureMenu" id="selectScriptEntryMenu"></div>

        <div class="textureDialogButtons">
            <button id="selectScriptEntryCancelBtn" onclick="closeSelectScriptEntryDlg()">Cancel</button>
            <button id="selectScriptEntrySelectBtn" onclick="selectScriptEntry()">Select</button>
        </div>
    </div>

    <div class="modal" id="addElementDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:400px;height:500px;">
        <div class="card" id="addElementDlgCard" style="padding:16px;">
          <center>
            <h4 class="title is-4">Add Element</h4>
            <label for="addElementNameBox">Element Name</label>
            <input class="input" type="text" name="addElementNameBox" id="addElementNameBox" placeholder="Element Name">
            <br><br>
            <label for="addElementIDBox">Element Identifier</label>
            <input class="input" type="text" name="addElementIDBox" id="addElementIDBox" placeholder="Element ID">
            <br><br>
            <label for="addElementType">Element Type</label>
            <div class="select">
              <select name="addElementType" id="addElementType">
                <option selected>Block</option>
                <option>Item</option>
                <option>Entity</option>
                <option>Recipe</option>
                <option>Function</option>
                <option>Script</option>
                <option>Loot Table</option>
                <option>Trade Table</option>
                <option disabled>Command</option>
                <option disabled>Biome</option>
                <option>Structure</option>
                <option disabled>Advancement</option>
                <option disabled>Dialog</option>
              </select>
            </div>
            <br><br>
            <button class="button" id="addElementCancelBtn" onclick="closeAddElementDlg()">Cancel</button>
            <button class="button is-primary" id="addElementAddBtn" onclick="addElement()">Add</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeAddElementDlg();"></button>
    </div>

    <div class="modal" id="addAssetDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:400px;height:600px;">
        <div class="card" id="addAssetDlgCard" style="padding:16px;">
          <center>
            <h4 class="title is-4">Add Asset</h4>
            <span>Upload an asset to add it to your project, or create a blank texture to edit. Accepts PNG textures, WAV audio, JSON geometry files, and MCSTRUCTURE files.</span>
            <br><br>
            <div class="select">
              <select id="addAssetModeMenu">
                <option value="upload">Upload</option>
                <option value="blank">Blank Image</option>
              </select>
            </div>
            <br><br>
            <div id="addAssetUploadDiv">
              <button class="button" onclick="document.getElementById('addAssetUploadInput').click()" id="addAssetUploadBtn">Upload...</button>
              <input type="file" id="addAssetUploadInput" style="display:none" accept=".png, .wav, .json, .mcstructure">
            </div>
            <div id="addAssetBlankDiv">
              W <input class="input smallInput" id="addAssetBlankBoxW" type="number">
              H <input class="input smallInput" id="addAssetBlankBoxH" type="number">
            </div>
            <br><br>
            <label for="addAssetNameBox">Asset Name</label>
            <input class="input" type="text" id="addAssetNameBox" name="addAssetNameBox" placeholder="Asset Name">
            <br><br>
            <button class="button" id="addAssetCancelBtn" onclick="closeAddAssetDlg()">Cancel</button>
            <button class="button is-primary" id="addAssetAddBtn" onclick="addAsset()">Add</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeAddAssetDlg();"></button>
    </div>

    <div class="modal" id="exportDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:400px;height:500px;">
        <div class="card" id="exportDlgCard" style="padding:16px;">
          <center>
            <h4 class="title is-4">Export Project</h4>
            <label for="exportDlgModeBox">Export Mode</label>
            <div class="select">
              <select id="exportDlgModeBox">
                <option value="1mcaddon">Addon (.mcaddon)</option>
                <option value="1zip">Addon (.zip)</option>
                <option value="2mcpack">Packs (.mcpack)</option>
                <option value="2zip">Packs (.zip)</option>
              </select>
            </div>
            <br><br>
            <iframe id="exporterFrame"></iframe>
            <div id="exportLog"></div>
            <br>
            <button class="button" onclick="closeExportDlg()" id="exportDlgCancelBtn">Cancel</button>
            <button class="button is-primary" onclick="exportProj()" id="exportDlgExportBtn">Export</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeExportDlg();"></button>
    </div>

    <div class="modal" id="optionsDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:600px;height:600px;">
        <div class="card" id="optionsDlgCard" style="padding:16px;padding-top:12px;height:100%;">
          <div class="tabs" id="optionsTabs">
            <ul>
              <li id="optionsTab1" onclick="switchOptionsTab(1)" class="is-active"><a>General</a></li>
              <li id="optionsTab2" onclick="switchOptionsTab(2)"><a>Account</a></li>
              <li id="optionsTab3" onclick="switchOptionsTab(3)"><a>Extensions</a></li>
              <li id="optionsTab4" onclick="switchOptionsTab(4)"><a>About</a></li>
              <li id="optionsTab5" onclick="switchOptionsTab(5)"><a>Developer</a></li>
            </ul>
          </div>
          <div id="optionsContent1">
            <h3 class="title is-3">General</h3>
            <label for="themeMenu">Theme</label>
            <div class="select">
              <select id="themeMenu">
                <option value="system" selected>Automatic</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
            </div>
            <br><br>
            <label for="autosaveBox">Enable Autosave</label>
            <input id="autosaveBox" type="checkbox" class="is-primary">
            <br><br>
            <label for="storageModeBox">Storage Mode</label>
            <div class="select">
              <select id="storageModeBox">
                <option id="storageModeBoxOpt1" selected value="file_system">File System (recommended - desktop only)</option>
                <option value="local_storage">Local Storage (for mobile users)</option>
              </select>
            </div>
          </div>
          <div id="optionsContent2">
            <h3 class="title is-3">Account</h3>
            <p>Coming Soon!</p><br>
            <div>
              <p id="accountNameText">Not signed in</p>
              <button id="signInBtn" class="button is-primary" onclick="if(signedIn){signOut();}else{openSignInDlg();}">Sign In</button>
            </div>
          </div>
          <div id="optionsContent3">
            <h3 class="title is-3">Extensions</h3>
            <p>Coming Soon!</p>
          </div>
          <div id="optionsContent4">
            <h3 class="title is-3">About</h3>
            <img src="moddery_logo.svg" style="height: 70px; width: 200px;"><br>
            <h5 id="aboutText" class="title is-5">Moddery</h4>
          </div>
          <div id="optionsContent5">
            <h3 class="title is-3">Developer</h3>
            <button class="button" onclick="clearCache()">Clear Cache</button>
          </div>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeOptionsDlg();"></button>
    </div>

    <div class="modal" id="loaderDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:300px;height:150px;">
        <div class="card" id="loaderDlgCard" style="padding:16px;">
          <center>
            <span id="loaderText">Loading...</span><br>
            <progress class="progress is-large is-primary" id="loaderProgress" max="0" value="0"></progress>
          </center>
        </div>
      </div>
    </div>

    <div class="modal" id="deleteDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:350px;height:250px;">
        <div class="card" id="deleteDlgCard" style="padding:16px;">
          <center>
            <h3 class="title is-3" id="deleteDlgTitle">Delete Element</h3>
            <span id="deleteDlgText"></span><br><br>
            <button class="button" id="deleteDlgCancel" onclick="closeDeleteElement()">Cancel</button>
            <button class="button is-danger" id="deleteDlgConfirm" onclick="deleteElement()">Delete</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeDeleteElement();"></button>
    </div>

    <div class="modal" id="renameDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:350px;height:300px;">
        <div class="card" id="renameDlgCard" style="padding:16px;">
          <center>
            <h3 class="title is-3" id="renameDlgTitle">Rename Element</h3>
            <span id="renameDlgText"></span><br><br>
            <input class="input" id="renameDlgBox"><br><br>
            <button class="button" id="renameDlgCancel" onclick="closeRenameElement()">Cancel</button>
            <button class="button is-primary" id="renameDlgConfirm" onclick="renameElement()">Rename</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeRenameElement();"></button>
    </div>

    <div class="modal" id="elementInfoDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:300px;height:300px;">
        <div class="card" id="elementInfoDlgCard" style="padding:16px;">
          <center>
            <h3 class="title is-3" id="elementInfoDlgTitle">Element Info</h3>
            <p id="elementInfoDlgContent"></p><br>
            <button class="button is-primary" id="elementInfoDlgClose" onclick="closeElementInfo()">Close</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeElementInfo();"></button>
    </div>

    <div class="modal" id="signInDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:300px;height:500px;">
        <div class="card" id="signInDlgCard" style="padding:16px;">
          <center>
            <h4 class="title is-4" id="signInDlgText1">Sign in to Moddery!</h4>
            <span id="signInDlgText2">Don't have an account? </span>
            <a href="javascript:switchSignInMode()" id="signInDlgModeLink">Sign Up</a>
            <br><br>
            <label for="signInDlgUsernameBox">Username</label><br>
            <input class="input" name="signInDlgUsernameBox" id="signInDlgUsernameBox"><br><br>
            <label for="signInDlgPasswordBox">Password</label><br>
            <input class="input" name="signInDlgPasswordBox" id="signInDlgPasswordBox" type="password"><br><br>
            <label for="signInDlgPasswordBox2" id="signInDlgPasswordBox2Label">Confirm Password</label><br>
            <input class="input" name="signInDlgPasswordBox2" id="signInDlgPasswordBox2" type="password">
            <br><br>
            <button class="button" id="signInDlgCancel" onclick="closeSignInDlg()">Cancel</button>
            <button class="button is-primary" id="signInDlgSignIn" onclick="signIn()">Sign In</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeSignInDlg();"></button>
    </div>

    <div class="modal" id="openProjDBDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:500px;height:600px;">
        <div class="card" id="openProjDBDlgCard" style="padding:16px;">
          <center>
            <span class="title is-4">Projects</span>
            <button class="button is-primary" id="openProjDBDlgNewBtn" onclick="closeOpenProjDlg();openNewProjDlg();">+ New Project</button>
            <div id="openProjDBDlgContent"></div>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeOpenProjDlg();"></button>
    </div>

    <div class="modal" id="deleteProjDlg">
      <div class="modal-background"></div>
      <div class="modal-content" style="width:350px;height:250px;">
        <div class="card" id="deleteProjDlgCard" style="padding:16px;">
          <center>
            <h3 class="title is-3" id="deleteProjDlgTitle">Delete Project?</h3>
            <span id="deleteProjDlgText">Are you sure you want to delete the project? This action cannot be undone!</span><br><br>
            <button class="button" id="deleteProjDlgCancel" onclick="closeDeleteProj()">Cancel</button>
            <button class="button is-danger" id="deleteProjDlgConfirm" onclick="deleteCurrentProj()">Delete</button>
          </center>
        </div>
      </div>
      <button class="modal-close is-large" aria-label="close" onclick="closeDeleteProj();"></button>
    </div>

    <input id="openFileInput" type="file" accept=".zip">

    <script src="libs.js"></script>
    <script src="database_libs.js"></script>
    <script src="main.js"></script>
  </body>
</html>